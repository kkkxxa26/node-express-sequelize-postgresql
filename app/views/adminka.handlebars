
<header>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <div class="header-left-text">Админ-панель</div>
    
  <div class="header-right">
    <div class="user-avatar">
       <i class="fas fa-user"></i>
       <div class="site-header">{{user.dataValues.name}}</div>
    </div>

    <div class="logout-icon" onclick="handleLogout()" title="Выйти">
      <i class="fas fa-sign-out-alt"></i>
    </div>
</header>

<body>
<div class="nav-buttons">
  <button class="nav-btn active" data-section="users-section">Пользователи</button>
  <button class="nav-btn" data-section="lectures-section">Лекции</button>
  <button class="nav-btn" data-section="tests-section">Тесты</button>
</div>

<div class="section-grid">


<!-- Секция пользователей -->
<div id="users-section" class="section active">
  <h2>Список пользователей</h2>
  <table id="user-table" class="user-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>ФИО</th>
        <th>Email</th>
        <th>Телефон</th>
        <th>Дата рождения</th>
        <th>Пол</th>
        <th>Роль</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
   

<!-- Секция лекций -->
<div id="lectures-section" class="section" style="display: none;">
  <h2>Список лекций</h2>
  <table id="lecture-table" class="user-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Заголовок</th>
        <th>Описание</th>
        <th>Дата создания</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>


<!-- Секция тестов -->
<div id="tests-section" class="section" style="display: none;">
  <h2>Список тестов</h2>
  <table id="test-table" class="user-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Заголовок</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
</div>



<div id="confirm-modal" class="modal-overlay" style="display: none;">
  <div class="modal-window">
    <p>Вы уверены, что хотите удалить пользователя?</p>
    <div class="modal-actions">
      <button id="confirm-yes" class="modal-btn danger">Удалить</button>
      <button id="confirm-no" class="modal-btn">Отмена</button>
    </div>
  </div>
</div>

<div id="notification" style="
  display: none;
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #4CAF50;
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  z-index: 1000;
">Пользователь удалён</div>



  <!-- Подключение jQuery и логика -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>

function showNotification(message) {
  const notification = $('#notification');
  notification.text(message).fadeIn();

  setTimeout(() => {
    notification.fadeOut();
  }, 3000); // исчезнет через 3 секунды
}


let userToDeleteId = null;

function deleteUser(id) {
  userToDeleteId = id;
  $('#confirm-modal').fadeIn();
}
// При нажатии "Удалить"
$('#confirm-yes').on('click', function () {
  if (!userToDeleteId) return;

  $.ajax({
    url: `/api/users/${userToDeleteId}`,
    method: 'DELETE',
    success: () => {
      $('#confirm-modal').fadeOut();
      userToDeleteId = null;
      console.log("Таблица обновляется")
      loadUsers();
      showNotification("Пользователь удалён");
     // alert("Пользователь удалён");
    },
    error: () => {
      $('#confirm-modal').fadeOut();
      userToDeleteId = null;
      alert("Ошибка при удалении пользователя");
    }
  });
});

// При нажатии "Отмена"
$('#confirm-no').on('click', function () {
  userToDeleteId = null;
  $('#confirm-modal').fadeOut();
});


// Удаление лекции
function deleteLecture(id) {
  if (!confirm("Удалить лекцию?")) return;
  $.ajax({
    url: `/api/lections/${id}`,
    method: 'DELETE',
    success: () => {
      alert("Лекция удалена");
      loadLectures();
    },
    error: () => alert("Ошибка при удалении лекции")
  });
}

// Удаление теста
function deleteTest(id) {
  if (!confirm("Удалить тест?")) return;
  $.ajax({
    url: `/api/lab/deleteHead/${id}`,
    method: 'DELETE',
    success: () => {
      alert("Тест удалён");
      loadTests();
    },
    error: () => alert("Ошибка при удалении теста")
  });
}


// Загрузка юзера
function loadUsers() {
  const tbody = $('#user-table tbody');
  tbody.empty();
  $.ajax({
    url: '/api/users',
    method: 'GET',
    dataType: 'json',
    success: function (data) {
      if (!Array.isArray(data) || data.length === 0) {
        tbody.append('<tr><td colspan="7">Нет пользователей.</td></tr>');
        return;
      }
      data.forEach(function (user) {
        const row = `
          <tr>
            <td>${user.id}</td>
            <td>${user.surname} ${user.name}</td>
            <td>${user.email}</td>
            <td>${user.phoneNumber}</td>
            <td>${new Date(user.birthDate).toLocaleDateString()}</td>
            <td>${user.gender}</td>
            <td>${user.role}</td>
                  
          <td class="action-buttons">
           <button class="icon-button edit" onclick="editUser(${user.id})" title="Редактировать">
              <i class="fas fa-edit"></i>
            </button>

          <button type ="button" class="icon-button delete" onclick="deleteUser(${user.id})" title="Удалить">
            <i class="fas fa-trash-alt"></i>
          </button>

          </td>
          </tr>
        `;
        tbody.append(row);
      });
    },
    error: function () {
      tbody.html('<tr><td colspan="7">Ошибка загрузки пользователей.</td></tr>');
    }
  });
}


  $(document).ready(function () {



    // Переключение секций
    $('.nav-btn').on('click', function () {
      const target = $(this).data('section');

      // Переключение активной кнопки
      $('.nav-btn').removeClass('active');
      $(this).addClass('active');

      // Показать нужную секцию
      $('.section').hide();
      $('#' + target).show();

      // Загрузка данных по секциям
      if (target === 'lectures-section') {
        loadLectures();
      } else if (target === 'tests-section') {
        loadTests();
      } else {
        loadUsers();
      }
    });


  // Первая загрузка — покажем пользователей
  loadUsers();

    // Загрузка лекций
 function loadLectures() {
  const tbody = $('#lecture-table tbody');
  tbody.empty();
  $.ajax({
    url: '/api/lections',
    method: 'GET',
    dataType: 'json',
    success: function (data) {
      if (!Array.isArray(data) || data.length === 0) {
        tbody.append('<tr><td colspan="4">Нет доступных лекций.</td></tr>');
        return;
      }
      data.forEach(function (lecture) {
        const row = `
          <tr>
            <td>${lecture.id}</td>
            <td>${lecture.title}</td>
            <td>${lecture.description || ''}</td>
            <td>${new Date(lecture.createdAt).toLocaleDateString()}</td>

            <td class="action-buttons">
            <button class="icon-button edit" onclick="ediLecture(${lecture.id})" title="Редактировать">
              <i class="fas fa-edit"></i>
            </button>
            
             <button class="icon-button delete" onclick="deleteLecture(${lecture.id})" title="Удалить">
            <i class="fas fa-trash-alt"></i>
            </button>

            </td>
          </tr>
        `;
        tbody.append(row);
      });
    },
    error: function () {
      tbody.html('<tr><td colspan="4">Ошибка загрузки лекций.</td></tr>');
    }
  });
}


    // Загрузка тестов
function loadTests() {
  const tbody = $('#test-table tbody');
  tbody.empty();
  $.ajax({
    url: '/api/lab/allHead',
    method: 'GET',
    dataType: 'json',
    success: function (data) {
      if (!Array.isArray(data) || data.length === 0) {
        tbody.append('<tr><td colspan="4">Тесты не найдены.</td></tr>');
        return;
      }
      data.forEach(function (test) {
        const row = `
          <tr>
            <td>${test.id}</td>
            <td>${test.title}</td>
            <td class="action-buttons">
           <button class="icon-button edit" onclick="editTest(${test.id})" title="Редактировать">
              <i class="fas fa-edit"></i>
            </button>
            
             <button class="icon-button delete" onclick="deleteTest(${test.id})" title="Удалить">
              <i class="fas fa-trash-alt"></i>
            </button>

            </td>
          </tr>
        `;
        tbody.append(row);
      });
    },
    error: function () {
      tbody.html('<tr><td colspan="4">Ошибка загрузки тестов.</td></tr>');
    }
  });
}

});

  function handleLogout() {
    window.location.href = '/logout';
  }

</script>

</body>